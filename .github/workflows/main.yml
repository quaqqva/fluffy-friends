name: Deploy and Run Script

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: üöÄ Execute remote script via SSH
        uses: appleboy/ssh-action@v1.2.2
        with:
          host: ${{ secrets.SSH_HOST }}
          username: ${{ secrets.SSH_USERNAME }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            if [ -d "/var/www/flufy-friends" ]; then
              echo "üìÇ –ü–∞–ø–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –æ–±–Ω–æ–≤–ª—è—é —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π..."
              cd /var/www/flufy-friends
              git checkout main
              git pull origin main
            else
              echo "üìÇ –ü–∞–ø–∫–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –∫–ª–æ–Ω–∏—Ä—É—é —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π..."
              git clone -b main git clone https://quaqqva:${GITHUB_TOKEN}@github.com/quaqqva/fluffy-friends.git /var/www/flufy-friends /var/www/flufy-friends
              cd /var/www/flufy-friends
            fi
            sudo bash ./scripts/docker-run.sh prod
            sudo bash ./scripts/docker-migrate.sh

